MATCH (pub:Publicacao)
OPTIONAL MATCH (p1:Pessoa)-[:CURTIU]->(pub)
OPTIONAL MATCH (p2:Pessoa)-[:COMENTOU]->(pub)
WITH pub,
     count(DISTINCT p1) AS curtidas,
     count(DISTINCT p2) AS comentarios
RETURN pub.id AS idPublicacao,
       pub.legenda AS legenda,
       curtidas,
       comentarios
ORDER BY curtidas DESC, comentarios DESC
LIMIT 10;